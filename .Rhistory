fitmeasures(fit_mer_redis_israel)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
#                   fitmeasures(fit_mer_redis_italia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_japon)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
#                   fitmeasures(fit_mer_redis_letonia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_lituania)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_nuevazelanda)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_noruega)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_filipinas)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_polonia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_rusia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_eslovaquia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_eslovenia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_sudafrica)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_espana)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_suecia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_suiza)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_turquia)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_ucrania)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_reinounido)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_redis_estadosunidos)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")])
sum_fit$mod <- c("Argentina","Australia","Austria", "Belguim","Bulgaria","Chile","China","Taiwan", "Chequia","Dinamarca","EST","Finlandia","Francia","Deutschland", "Venezuela#", "Islandia", "Israel", "Japon","Lituania","Nueva Zelanda", "Noruega", "Filipinas", "Polonia", "Rusia","Eslovequia","Eslovenia","Sudafrica", "EspaÃ±a","Suecia","Suiza","Truquia","Ucrania","Reino Unido", "Estados Unidos.")
colnames <- c("Model","$\\chi2$","df","CFI","RMSEA","RMSEA CI lower", "RMSEA CI upper")
sum_fit <- sum_fit %>% dplyr::select("mod","chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")
sumtable01<- kable(sum_fit,digits = 3,format = "html",row.names = F,booktabs=T, caption = "Summary fit country",col.names = colnames,escape = FALSE) %>%
kable_styling(full_width = F)  %>%
collapse_rows(columns = 1,valign = "middle");sumtable01
# Chunk 14
# CFA with secon order unmerit
cfa_mer_red2 <- '
# latent variables
merit =~ hwork + ambition
parent=~ wealthy + pareduc
backg=~ race + gender
network=~ people + polcone
bmerit =~ welljob + hardjob
need=~ family + child
redist =~ income_dif + unemployed + taxes
accum  =~ health + educ
unmerit =~ parent + backg + network
'
fit_mer_red2 <- cfa(cfa_mer_red2,data=merit_redist,
missing = "ML")
#	 summary(fit_mer_red1, fit.measures=TRUE,standardized=TRUE)
fit_mer_red2c <- cfa(cfa_mer_red2,data=merit_redist,
ordered = names(merit_redist[3:10,19:29]))
#	summary(fit_mer_redc, fit.measures=TRUE,standardized=TRUE)
sum_fit<- bind_rows(fitmeasures(fit_mer_red2)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")],
fitmeasures(fit_mer_red2c)[c("chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")])
sum_fit$mod <- c("Model 1","Model 2")
sum_fit$est <- c("MLR","DWLS")
sum_fit <- sum_fit %>% dplyr::select("mod","est","chisq","df","cfi","rmsea","rmsea.ci.lower","rmsea.ci.upper")
colnames <- c("Model","Estimator","$\\chi2$","df","CFI","RMSEA","RMSEA CI lower", "RMSEA CI upper")
sumtable01<- kable(sum_fit,digits = 3,format = "html",row.names = F,booktabs=T, caption = "Summary fit",col.names = colnames,escape = FALSE) %>%
kable_styling(full_width = F)  %>%
collapse_rows(columns = 1,valign = "middle")  %>%
footnote(number = c("Model 1: Continue item",
"Model 2: Ordered item)"));sumtable01
semPlot::semPaths(fit_mer_red2,layout = "circle", rotation = 3,
intercepts = FALSE, style = "lisrel", curvePivot = TRUE,
sizeMan = 4, sizeLat = 6)
# Chunk 15
# Factor scores
fscores <- as.data.frame(lavPredict(fit_mer_red2))
# Correlations
cormat=cor(fscores[c(7,8,1,9,5,6)],
use="pairwise.complete.obs")
corrplot.mixed(cormat)
#save
png("output/results/corplot_totscores.png",width=600,height=600)
dev.off()
# Chunk 16
#Se agrega la base de datos dejando paises como
mer_pref_agg=aggregate(mer_pref, by=list(mer_pref$v5c),
FUN=mean, na.rm=TRUE)
names(mer_pref_agg)[names(mer_pref_agg)=="Group.1"]="v5c"
load("input/data/proc/meritocracy.rda")
# Adjust data
merit_agg=aggregate(meritocracy, by=list(meritocracy$v5c),
FUN=mean, na.rm=TRUE)
names(merit_agg)[names(merit_agg)=="Group.1"]="v5c"
#   names(merit_agg)
#  dim(merit_agg)
load("input/data/proc/mer_pref_polycor.rda")
corMat <- cor(mer_pref_polycor, use="pairwise.complete.obs")
corrplot.mixed(corMat)
# Chunk 17
plotredistgini<-plot_scatter(mer_pref_agg, gini_neto, redist,
title = "Desigualdad ",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotredistgini_outliers <- plot_scatter(mer_pref_agg_zaf, gini_neto, redist,
title = "Desigualdad (sin outliers)",
fit.line = lm,
show.ci = TRUE
) + theme_classic()
plotredistfi<-plot_scatter(mer_pref_agg,  fi_index, redist,
title = "Libertad economica",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotredistfi_outliers<-plot_scatter(mer_pref_agg_ven,  fi_index, redist,
title = "Libertad economica (sin outliers)",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
ggsave(plot = plot_grid(list(plotredistgini, plotredistgini_outliers, plotredistfi, plotredistfi_outliers),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_redistmacro.png", width = 10, height = 10, dpi= "retina")
# Chunk 18
plotredistmerit <- plot_scatter(mer_pref_agg,  merit, redist,
title = "Percepcion meritocratica",
#	dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotredistbmerit <-plot_scatter(mer_pref_agg,  bmerit, redist,
title = "Preferencias meritocraticas",
#	dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotredistunmerit <-plot_scatter(mer_pref_agg,  unmerit, redist,
title = "Percepcion no meritocratica",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotredistneed <-plot_scatter(mer_pref_agg,  need, redist,
title = "Preferenciasno meritocraticas ",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
ggsave(plot = plot_grid(list(plotredistmerit, plotredistbmerit, plotredistunmerit, plotredistneed),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_redistmerit.png", width = 10, height = 10, dpi= "retina")
# Chunk 19
plotaccumgini<-plot_scatter(mer_pref_agg, gini_neto, accum,
title = "Desigualdad ",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotaccumgini_outliers <- plot_scatter(mer_pref_agg_zaf, gini_neto, accum,
title = "Desigualdad (sin outliers)",
#dot.labels = merit_agg$v5c,
fit.line = lm,
show.ci = TRUE
)  + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotaccumfi<-plot_scatter(mer_pref_agg, fi_index, accum,
title = "Libertad economica",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)   + theme_classic()
plotaccumfi_outliers<-plot_scatter(mer_pref_agg_ven,  fi_index, accum,
title = "Libertad economica (sin outliers)",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)   + theme_classic()
ggsave(plot = plot_grid(list(plotaccumgini, plotaccumgini_outliers, plotaccumfi, plotaccumfi_outliers),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_accumginifi.png", width = 10, height = 10, dpi= "retina")
# Chunk 20
plotaccummerit <- plot_scatter(mer_pref_agg,  merit, accum,
title = "Percepcion meritocratica",
#	dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
plotaccumbmerit <-plot_scatter(mer_pref_agg,  bmerit, accum,
title = "Preferencias meritocraticas",
#	dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
plotaccumunmerit <-plot_scatter(mer_pref_agg,  unmerit, accum,
title = "Percepcion no meritocratica",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
plotaccumneed <-plot_scatter(mer_pref_agg,  need, accum,
title = "Preferenciasno meritocraticas ",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
ggsave(plot = plot_grid(list(plotaccummerit, plotaccumbmerit, plotaccumunmerit, plotaccumneed),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_accummerit.png", width = 10, height = 10, dpi= "retina")
# Chunk 21
plotginimerit <- plot_scatter(mer_pref_agg,gini_neto,  merit,
title = "Percepcion meritocratica y desigualdad",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotginimerit_out <- plot_scatter(mer_pref_agg_zaf,gini_neto,  merit,
title = "Percepcion meritocratica y desigualdad (sin outliers)",
#dot.labels = merit_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotgfimerit <- plot_scatter(mer_pref_agg,fi_index,  merit,
title = "Percepcion meritocratica y libertad economica",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotgfimerit_out<- plot_scatter(mer_pref_agg_ven,fi_index,  merit,
title = "Percepcion meritocratica y libertad economica (sin outliers)",
#	dot.labels = mer_pref_agg_ven$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
ggsave(plot = plot_grid(list(plotginimerit, plotginimerit_out, plotgfimerit, plotgfimerit_out),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_meritginifi.png", width = 10, height = 10, dpi= "retina")
# Chunk 22
plotginibmerit <- plot_scatter(mer_pref_agg,gini_neto,  bmerit,
title = "Preferencias meritocraticas y desigualdad",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotginibmerit_out<- plot_scatter(mer_pref_agg_zaf,gini_neto,  bmerit,
title = "Preferencias meritocraticas y desigualdad (sin outliers)",
#	dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
plotfibmerit <- plot_scatter(mer_pref_agg,fi_index,  bmerit,
title = "Preferencias meritocraticas y libertad economica",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotfibmerit_out <- plot_scatter(mer_pref_agg_ven,fi_index,  bmerit,
title = "Preferencias meritocraticas y libertad economica (sin outliers)",
#	dot.labels = mer_pref_agg_ven$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
ggsave(plot = plot_grid(list(plotginibmerit, plotginibmerit_out, plotfibmerit, plotfibmerit_out),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_bmeritginifi.png", width = 10, height = 10, dpi= "retina")
# Chunk 23
plotginiunmerit <- plot_scatter(mer_pref_agg,gini_neto,  unmerit,
title = "Percepcion no meritocratica y desigualdad",
dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotginiunmerit_out<- plot_scatter(mer_pref_agg_zaf,gini_neto,  unmerit,
title = "Percepcion no meritocratica y desigualdad (sin outliers)",
#	dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotfiunmerit <- plot_scatter(mer_pref_agg,fi_index,  unmerit,
title = "Percepcion no meritocratica y libertad economica",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotfiunmerit_out <- plot_scatter(mer_pref_agg_ven,fi_index,  unmerit,
title = "Percepcion no meritocratica y libertad economica (sin outliers)",
#	dot.labels = mer_pref_agg_ven$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
ggsave(plot = plot_grid(list(plotginiunmerit, plotginiunmerit_out, plotfiunmerit, plotfiunmerit_out),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_unmeritginifi.png", width = 10, height = 10, dpi= "retina")
# Chunk 24
plotginineed <- plot_scatter(mer_pref_agg,gini_neto,  need,
title = "Preferencia no meritocratica y desigualdad",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE) + theme_classic()
mer_pref_agg_zaf <- mer_pref_agg[which(mer_pref_agg$v5c!='ZAF'), ]
plotginineed_out<- plot_scatter(mer_pref_agg_zaf,gini_neto,  need,
title = "Preferencia no meritocratica y desigualdad (sin outliers)",
#	dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
plotfineed <- plot_scatter(mer_pref_agg,fi_index,  need,
title = "Preferencia no meritocratica y libertad economica",
#dot.labels = mer_pref_agg$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
mer_pref_agg_ven <- mer_pref_agg[which(mer_pref_agg$v5c!='VEN'), ]
plotfineed_out <- plot_scatter(mer_pref_agg_ven,fi_index,  need,
title = "Preferencia no meritocratica y libertad economica (sin outliers)",
#	dot.labels = mer_pref_agg_ven$v5c,
fit.line = "lm",
show.ci = TRUE)  + theme_classic()
ggsave(plot = plot_grid(list(plotginineed, plotginineed_out, plotfineed, plotfineed_out),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_needginifi.png", width = 10, height = 10, dpi= "retina")
# Chunk 25
load(file="input/data/proc/mer_pref.rda")
# Modelo nulo
results_0_redist  = lmer(redist ~ 1 + (1| v5c), data = mer_pref, REML=F)
# Correlacion intraclase redist
htmlreg(results_0_redist)
reghelper::ICC(results_0_redist)
# Chunk 26
# Modelo nulo
results_0_accum = lmer(accum ~ 1 + (1| v5c), data = mer_pref, REML=F)
# Correlacion intraclases accum
htmlreg(results_0_accum)
reghelper::ICC(results_0_accum)
# Chunk 27
results_1_redist__1  = lmer(redist ~  gini_neto + fi_index + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist__2  = lmer(redist ~  gini_neto + fi_index + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_3 = lmer(redist ~ merit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_4 = lmer(redist ~  merit + bmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_5 = lmer(redist ~  merit + bmerit + unmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_6 = lmer(redist ~ merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_7 = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_8 = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_9 = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
htmlreg(list(results_1_redist__1,results_1_redist__2, results_1_redist_3,results_1_redist_4,results_1_redist_5,results_1_redist_6,results_1_redist_7, results_1_redist_8, results_1_redist_9),caption = "Modelos con predictores", omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)")
# Chunk 28
results_1_redist_dem  = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_indsust = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_macro = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_redist_macro_bv = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + 1 +  (1 + merit| v5c), data= mer_pref, REML=F)
results_3_redist_macro_bvi = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*gini_neto + fi_index + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_redist_macro_bvi_2 = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*fi_index + gini_neto + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
htmlreg(list(results_1_redist_macro,results_2_redist_macro_bv, results_3_redist_macro_bvi,results_3_redist_macro_bvi_2), caption = "Pendiente aleatorea e interaccion entre niveles", omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)")
# Chunk 29
sjPlot::plot_model(results_3_redist_macro_bvi, type="std", title = "Modelo final con predictores, pendiente aleatoria e interaccion.")
png("output/results/results_1_redist_macro.png")
sjPlot::plot_model(results_1_redist_macro, type="std")
dev.off()
graf2=ggpredict(results_2_redist_macro_bv, terms = c("merit","v5c [sample = 9]"), type="re")
plot(graf2)
png("output/results/mer_pref_mu.png")
plot(graf2)
dev.off()
sjPlot::plot_model(results_3_redist_macro_bvi, type = c("int"), title = "Interaccion desigualdad")
png("output/results/mer_redist_int_gini.png")
sjPlot::plot_model(results_3_redist_macro_bvi, type = c("int"))
dev.off()
sjPlot::plot_model(results_3_redist_macro_bvi_2, type = c("int"), title = "Interaccion libertad economica")
# Chunk 30
#analisis de casos influyentes
# Chunk 31
results_1_accum__1  = lmer(accum ~  gini_neto + fi_index + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_accum__2  = lmer(accum ~  gini_neto + fi_index + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_accum_3 = lmer(accum ~ merit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_4 = lmer(accum ~  merit + bmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_5 = lmer(accum ~  merit + bmerit + unmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_6 = lmer(accum ~ merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_7 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_8 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_9 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
htmlreg(list(results_1_accum__1,results_1_accum__2, results_1_accum_3,results_1_accum_4,results_1_accum_5,results_1_accum_6,results_1_accum_7, results_1_accum_8, results_1_accum_9), caption = "Modelos con predictores")
# Chunk 32
results_1_accum_macro = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_accum_macro_bv = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + fi_index + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + merit*fi_index + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi_2 = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  fi_index + merit*gini_neto + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
htmlreg(list(results_1_accum_macro,results_2_accum_macro_bv,results_3_accum_macro_bvi, results_3_accum_macro_bvi_2))
# Chunk 33
sjPlot::plot_model(results_3_accum_macro_bvi, type="std", title = "Modelo de pendiente aleatoria e interaccion (desigualdad)")
png("output/results/results_3_accum_macro_bvi_model")
sjPlot::plot_model(results_3_accum_macro_bvi, type="std")
dev.off()
graf2=ggpredict(results_2_accum_macro_bv, terms = c("merit","v5c [sample = 9]"), type="re")
plot(graf2)
png("output/results/mer_accum_mu.png")
plot(graf2)
dev.off()
sjPlot::plot_model(results_3_accum_macro_bvi, type = c("int"), title = "Interaccion Libertad economica" )
png("output/results/mer_accum_int_fi.png")
dev.off()
sjPlot::plot_model(results_3_accum_macro_bvi_2, type = c("int"), title = "Interaccion Desigualdad" )
png("output/results/mer_accum_int_fi.png")
dev.off()
# Chunk 34
# guardar tablas
#redis
save(results_1_redist_macro, file = "output/results/results_1_redist_macro.rdata")
save(results_2_redist_macro_bv, file = "output/results/results_2_redist_macro_bv.rdata")
save(results_3_redist_macro_bvi, file = "output/results/results_3_redist_macro_bvi.rdata")
#accum
save(results_1_accum_macro, file = "output/results/results_1_accum_macro.rdata")
save(results_2_accum_macro_bv, file = "output/results/results_2_accum_macro_bv.rdata")
save(results_3_accum_macro_bvi, file = "output/results/results_3_accum_macro_bvi.rdata")
# Chunk 35
results_1_accum_9 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
mer_pref_sinnonconvr<- mer_pref[which(mer_pref$v5c!='VEN'), ]
mer_pref_sinnonconvr<- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=191), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5c!='CYP'), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=380), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=428), ]
results_1_accum_9_sinnocon = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref_sinnonconvr, REML=F)
anova(results_1_accum_9, results_1_accum_9_sinnocon)
# Chunk 36
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
estex.m23_2 <- influence(results_3_accum_macro_bvi, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
ggsave(plot = plot_grid(list(influence_plot1, influence_plot2),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_redistmacro.png", width = 10, height = 10, dpi= "retina")
# Chunk 37
results_1_redist_9 = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
mer_pref_sinnonconvr<- mer_pref[which(mer_pref$v5c!='VEN'), ]
mer_pref_sinnonconvr<- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=191), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5c!='CYP'), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=380), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=428), ]
results_1_redist_9_sinconvr = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
anova(results_1_redist_9, results_1_redist_9_sinconvr)
# Chunk 38
estex.m23 <- influence(results_1_redist_9, "v5c")
estex.m23_2 <- influence(results_1_redist_9, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
ggsave(plot = plot_grid(list(influence_plot1, influence_plot2),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_redistmacro.png", width = 10, height = 10, dpi= "retina")
# Chunk 39
#Redis
pacman::p_load(influence.ME,
lattice, # dotplot
dplyr,
texreg
)
estex.m23 <- influence(results_3_redist_macro_bvi, "v5c")
plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
# Chunk 40
mer_pref_sininfl <- mer_pref[which(mer_pref$v5c!='ZAF'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CYP'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='TUR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='TWN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='UKR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CZE'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='FRA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='AUS'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='DNK'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='USA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='PHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='POL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHN'), ]
results_1_redist_9_sininf = lmer(redist ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref_sininfl, REML=F)
htmlreg(list(results_1_redist_9, results_1_redist_9_sininf))
# Chunk 41
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
mer_pref_sininfl <- mer_pref[which(mer_pref$v5c!='ZAF'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='FRA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='UKR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='ISR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='AUS'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='DNK'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='LVA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='PHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='POL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CZE'), ]
results_3_accum_macro_bvi_sininfl = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + merit*fi_index + 1 +  (1 + merit| v5c), data = mer_pref_sininfl, REML=F)
# Chunk 42
htmlreg(list(results_3_accum_macro_bvi, results_3_accum_macro_bvi_sininfl))
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
estex.m23_2 <- influence(results_3_accum_macro_bvi, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
ggsave(plot = plot_grid(list(influence_plot1, influence_plot2),margin = c(0.3,0.3,0.3,0.3), tags = c(" ", " ", " ", " ", " ", " ")), filename = "output/results/plot_redistmacro.png", width = 10, height = 10, dpi= "retina")
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
estex.m23_2 <- influence(results_3_accum_macro_bvi, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
plot_grid(list(influence_plot1, influence_plot2)
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
estex.m23_2 <- influence(results_3_accum_macro_bvi, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
plot_grid(list(influence_plot1, influence_plot2))
estex.m23 <- influence(results_3_accum_macro_bvi, "v5c")
estex.m23_2 <- influence(results_3_accum_macro_bvi, "v5c")
influence_plot1 <-plot(estex.m23, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance",
ylab="Contries")
influence_plot2 <-plot(estex.m23_2, which="cook",
cutoff=.17, sort=TRUE,
xlab="Cooks Distance without non-converge",
ylab="Contries")
plot_grid(list(influence_plot1, influence_plot2))
source('~/GitHub/meritocracy-preferences/render-site.R', echo=TRUE)
for render in pdf run rmarkdown::render_site("docs/paper.Rmd", output_format = "pdf_document")
rmarkdown::render_site("docs/paper.Rmd", output_format = "pdf_document")
rmarkdown::render_site("docs/paper.Rmd", output_format = "pdf_document")
rmarkdown::render_site("docs/paper.Rmd", output_format = "pdf_document")
source('~/GitHub/meritocracy-preferences/render-site.R', echo=TRUE)
source('~/GitHub/meritocracy-preferences/render-site.R', echo=TRUE)
source('~/GitHub/meritocracy-preferences/render-site.R', echo=TRUE)
